var mapViewModel=function(){var e=this;e.map=null,e.bounds=new google.maps.LatLngBounds,e.flickrURL="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=1c9f777eb7446f34a7261dc1a54be4b2&extras=geo&format=json&jsoncallback=?",e.txtFilterLocation=ko.observable(""),e.markers=ko.observableArray([{title:"Philip Island",lat:145.2031,lang:-38.4897},{title:"Dandenong Ranges",lat:145.3662,lang:-37.9086},{title:"Great Ocen Road",lat:144.7852,lang:-37.4713},{title:"St. Kilda Beach",lat:144.973,lang:-37.8669},{title:"Yarra River",lat:145.2218,lang:-37.7536}]),e.showMap=ko.observable({lat:ko.observable(-37.814),lng:ko.observable(144.96332)}),e.mapMarker=ko.observableArray([]),e.filteredMarkers=ko.computed(function(){var a=e.txtFilterLocation().toLowerCase();if(a){var t=0;return ko.utils.arrayFilter(e.mapMarker(),function(o){return-1===o.title.toLowerCase().indexOf(a)?e.mapMarker()[t].setMap(null):(e.mapMarker()[t].setMap(e.map.googleMap),markerAnimation(e.mapMarker()[t])),t++,-1!==o.title.toLowerCase().indexOf(a)})}for(var t=0;t<e.mapMarker().length;t++)e.mapMarker()[t].setMap(e.map.googleMap);return e.markers()},e),e.showFilters=function(){$("body").toggleClass("nav-expanded")},e.animateMarker=function(e){var a=ko.utils.arrayFirst(mapMarker(),function(a){return e.title===a.title});markerAnimation(a)}};ko.bindingHandlers.map={init:function(e,a,t,o){var r=ko.utils.unwrapObservable(a()),n=new google.maps.LatLng(ko.utils.unwrapObservable(r.lat),ko.utils.unwrapObservable(r.lng)),l={center:n,zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP};for(r.googleMap=new google.maps.Map(e,l),self.map=r,google.maps.event.addDomListener(window,"resize",function(){r.googleMap.setCenter(n)}),i=0;i<markers().length;i++)getFlickrPicture(self.flickrURL+"&lat="+markers()[i].lang+"&lon="+markers()[i].lat,markers()[i]);$("#"+e.getAttribute("id")).data("mapObj",r)}};var getFlickrPicture=function(e,a){$.ajax({url:e,type:"GET",dataType:"jsonp",success:showMarkersWithImages(a),fail:flickrFailure(a)})},showMarkersWithImages=function(e){return function(a,t,o){placeMarkers(e,a)}},flickrFailure=function(e){return function(a,t){placeMarkers(e,null)}},placeMarkers=function(e,a){position=new google.maps.LatLng(ko.utils.unwrapObservable(e.lang),ko.utils.unwrapObservable(e.lat));var t=new google.maps.Marker({map:self.map.googleMap,position:position,title:e.title,animation:google.maps.Animation.DROP,draggable:!1});bounds.extend(position),mapMarker.push(t),self.map.googleMap.fitBounds(bounds),google.maps.event.addListener(t,"click",function(){markerAnimation(t);var o=getInforWindow(e,a);o.open(self.map.googleMap,t)})},getInforWindow=function(e,a){var t="",o="";if(null!=a&&a.photos.photo.length>0){var r="https://farm"+a.photos.photo[0].farm+".static.flickr.com/"+a.photos.photo[0].server+"/"+a.photos.photo[0].id+"_"+a.photos.photo[0].secret+"_m.jpg";o='<p class="text-center"><strong>'+e.title+'</strong></p><img src="'+r+'">',t='<div id="content">'+o+"</div>"}else t='<div id="content">No images available currently. </div>';var n=new google.maps.InfoWindow({content:t});return n},markerAnimation=function(e){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},2100)};